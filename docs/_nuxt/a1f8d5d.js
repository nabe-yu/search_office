(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{259:function(e,t,n){"use strict";n.r(t);n(41),n(13),n(42),n(28),n(43),n(44);var r=n(8),f=(n(54),n(126),n(37),n(45),n(29),n(30),n(252),n(253),n(36),n(258)),c=n(251);function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,c=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){o=!0,f=e},f:function(){try{c||null==n.return||n.return()}finally{if(o)throw f}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var d={data:function(){return{csvData:null,offices:[],staffs:[],data:[],isUpload:"",staff_data_file:null,office_data_file:null,columns:[{field:"id",label:"ID"},{field:"home_address",label:"自宅"},{field:"current_office_name",label:"現在の勤務地"},{field:"current_office_distance",label:"現在の勤務地までの距離"},{field:"satellite_office_name",label:"最寄りオフィス"},{field:"satellite_office_distance",label:"最寄りオフィスまでの距離"},{field:"reduced_distance",label:"削減された距離"}]}},computed:{},methods:{json2csv:function(e){var t=Object.keys(e[1]).join(",")+"\n";return t+=e.map((function(e){return Object.keys(e).map((function(t){return e[t]})).join(",")})).join("\n"),this.csvData=t,t},upload:function(){this.uploadStaffData(),this.uploadOfficeData(),this.isUpload=!0},btn:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,r,f,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=0;case 1:if(!(n<e.offices.length)){t.next=8;break}return t.next=4,e.getCoordinates(e.offices[n].office_address);case 4:e.offices[n].coordinates=t.sent;case 5:n++,t.next=1;break;case 8:e.data=[],r=o(e.staffs),t.prev=10,c=regeneratorRuntime.mark((function t(){var n,r,c,l,d,_,v,m,h,C;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=f.value,r=e.offices.find((function(e){return e.id===n.office_id})),t.next=4,e.getCoordinates(n.home_address);case 4:c=t.sent,l=e.getDistance(c,r.coordinates),d=[],_=o(e.offices);try{for(_.s();!(v=_.n()).done;)m=v.value,d.push({name:m.office_name,dis:e.getDistance(c,m.coordinates)})}catch(e){_.e(e)}finally{_.f()}h=d.sort((function(a,b){if(a.dis<b.dis)return-1})),C={id:n.id,home_address:n.home_address,current_office_name:r.office_name,current_office_distance:l,satellite_office_name:h[0].name,satellite_office_distance:h[0].dis,reduced_distance:Math.round(100*(l-h[0].dis))/100},e.data.push(C);case 12:case"end":return t.stop()}}),t)})),r.s();case 13:if((f=r.n()).done){t.next=17;break}return t.delegateYield(c(),"t0",15);case 15:t.next=13;break;case 17:t.next=22;break;case 19:t.prev=19,t.t1=t.catch(10),r.e(t.t1);case 22:return t.prev=22,r.f(),t.finish(22);case 25:case"end":return t.stop()}}),t,null,[[10,19,22,25]])})))()},uploadOfficeData:function(){var e=this;this.offices="";var t=this.office_data_file,n=new FileReader;return n.onload=function(){e.offices=JSON.parse(n.result).offices},n.readAsText(t)},uploadStaffData:function(){var e=this;this.staffs="";var t=this.staff_data_file,n=new FileReader;return n.onload=function(){e.staffs=JSON.parse(n.result).staffs},n.readAsText(t)},getDistance:function(e,t){var n=Object(f.a)(Object(c.c)(e),Object(c.c)(t),{units:"kilometers"});return Math.round(100*n)/100},getCoordinates:function(address){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n="https://msearch.gsi.go.jp/address-search/AddressSearch?q=".concat(address),t.next=3,e.$axios.$get(n);case 3:return r=t.sent,t.abrupt("return",r[0].geometry.coordinates);case 5:case"end":return t.stop()}}),t)})))()}}},_=n(22),component=Object(_.a)(d,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{staticClass:"section"},[n("div",{staticClass:"content box"},[n("h2",{staticClass:"title is-5"},[e._v("\n      ファイルをアップロードしましょう\n    ")]),e._v(" "),n("p",{staticClass:"subtitle is-6"},[e._v("\n      JSON形式に対応しています。\n    ")]),e._v(" "),n("b-field",{staticClass:"file is-primary",class:{"has-name":!!e.staff_data_file}},[n("b-upload",{staticClass:"file-label",model:{value:e.staff_data_file,callback:function(t){e.staff_data_file=t},expression:"staff_data_file"}},[n("span",{staticClass:"file-cta"},[n("b-icon",{staticClass:"file-icon",attrs:{icon:"upload"}}),e._v(" "),n("span",{staticClass:"file-label"},[e._v("個人情報")])],1),e._v(" "),e.staff_data_file?n("span",{staticClass:"file-name"},[e._v("\n          "+e._s(e.staff_data_file.name)+"\n        ")]):e._e()])],1),e._v(" "),e.staffs.length>0?n("p",[e._v("\n      "+e._s(e.staffs.length)+" 件\n    ")]):e._e(),e._v(" "),n("b-field",{staticClass:"file is-primary",class:{"has-name":!!e.office_data_file}},[n("b-upload",{staticClass:"file-label",model:{value:e.office_data_file,callback:function(t){e.office_data_file=t},expression:"office_data_file"}},[n("span",{staticClass:"file-cta"},[n("b-icon",{staticClass:"file-icon",attrs:{icon:"upload"}}),e._v(" "),n("span",{staticClass:"file-label"},[e._v("オフィス情報")])],1),e._v(" "),e.office_data_file?n("span",{staticClass:"file-name"},[e._v("\n          "+e._s(e.office_data_file.name)+"\n        ")]):e._e()])],1),e._v(" "),e.offices.length>0?n("p",[e._v("\n      "+e._s(e.offices.length)+" 件\n    ")]):e._e()],1),e._v(" "),n("div",{staticClass:"columns"},[n("div",{staticClass:"column"},[e.office_data_file&&e.staff_data_file?n("div",[n("b-button",{staticClass:"is-large",attrs:{type:"is-info",expanded:"",outlined:""},on:{click:function(t){return e.upload()}}},[e._v("\n          ファイルを読み込む\n        ")])],1):e._e()]),e._v(" "),n("div",{staticClass:"column"},[e.isUpload?n("b-button",{staticClass:"is-large",attrs:{type:"is-danger",expanded:"",outlined:""},on:{click:function(t){return e.btn()}}},[e._v("\n        計算する ( "+e._s(e.data.length)+" 件)\n      ")]):e._e()],1),e._v(" "),n("div",{staticClass:"column"},[e.data.length>0&&e.data.length>=e.staffs.length?n("b-button",{staticClass:"is-large",attrs:{type:"is-dark",expanded:"",outlined:""},on:{click:function(t){return e.json2csv(e.data)}}},[e._v("\n        結果をCSVで表示する\n      ")]):e._e()],1)]),e._v(" "),e.csvData?n("div",{staticClass:"box",staticStyle:{"white-space":"pre-wrap"}},[e._v("\n    "+e._s(e.csvData)+"\n  ")]):e._e(),e._v(" "),e.data?n("b-table",{attrs:{data:e.data,columns:e.columns}}):e._e()],1)}),[],!1,null,null,null);t.default=component.exports}}]);